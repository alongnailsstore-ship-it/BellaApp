<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:BellaLink.App.ViewModels.PartnerViewModels"
             xmlns:converters="clr-namespace:BellaLink.App.Converters"
             x:Class="BellaLink.App.Views.PartnerViews.PartnerUploadPage"
             Title="Gerenciar VÃ­deos"
             BackgroundColor="White"
             Shell.NavBarIsVisible="False">

    <ContentPage.Resources>
        <converters:StringNotNullOrEmptyConverter x:Key="StringNotNullOrEmptyConverter" />
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto, *">
        <Grid ColumnDefinitions="Auto, *" Padding="20">
            <ImageButton Command="{Binding GoBackCommand}" Source="{FontImageSource Glyph='â¬…', Color='#333', Size=30}"
                         HorizontalOptions="Start" BackgroundColor="Transparent"/>
            <Label Grid.Column="1" Text="Publicar VÃ­deo" FontSize="20" FontAttributes="Bold" TextColor="#FF4081" 
                   VerticalOptions="Center" HorizontalOptions="Center" Margin="-40,0,0,0"/>
        </Grid>

        <ScrollView Grid.Row="1" Padding="20">
            <VerticalStackLayout Spacing="20">

                <VerticalStackLayout Spacing="15">

                    <VerticalStackLayout Spacing="5">
                        <Label Text="TÃ­tulo" FontAttributes="Bold" TextColor="#333"/>
                        <Border Stroke="#DDD" StrokeShape="RoundRectangle 8" HeightRequest="45" Padding="10,0">
                            <Entry Text="{Binding Title}" Placeholder="Ex: Unhas de Gel" TextColor="#333"/>
                        </Border>
                    </VerticalStackLayout>

                    <VerticalStackLayout Spacing="5">
                        <Label Text="Arquivo de VÃ­deo" FontAttributes="Bold" TextColor="#333"/>

                        <Button Text="ðŸ“ Carregar da Galeria" 
                                Command="{Binding UploadVideoFromFileCommand}"
                                BackgroundColor="#E0E0E0" TextColor="#333"
                                CornerRadius="8" HeightRequest="45"/>

                        <Label Text="{Binding UploadStatus}" TextColor="#FF4081" FontSize="12" FontAttributes="Bold" 
                               IsVisible="{Binding UploadStatus, Converter={StaticResource StringNotNullOrEmptyConverter}}"/>

                        <Label Text="Ou cole o Link (URL) manualmente:" FontSize="12" TextColor="#666" Margin="0,5,0,0"/>

                        <Border Stroke="#DDD" StrokeShape="RoundRectangle 8" HeightRequest="45" Padding="10,0">
                            <Entry Text="{Binding VideoUrlInput}" Placeholder="https://..." TextColor="#333"/>
                        </Border>
                        <Label Text="* Se usar upload, o link aparecerÃ¡ acima automaticamente." FontSize="10" TextColor="#999"/>
                    </VerticalStackLayout>
                    <VerticalStackLayout Spacing="5">
                        <Label Text="DescriÃ§Ã£o (Opcional)" FontAttributes="Bold" TextColor="#333"/>
                        <Border Stroke="#DDD" StrokeShape="RoundRectangle 8" HeightRequest="80" Padding="10">
                            <Editor Text="{Binding Description}" Placeholder="Detalhes..." TextColor="#333" AutoSize="TextChanges"/>
                        </Border>
                    </VerticalStackLayout>

                    <Button Text="PUBLICAR AGORA" 
                            Command="{Binding PublishByUrlCommand}"
                            BackgroundColor="#FF4081" TextColor="White" FontAttributes="Bold"
                            HeightRequest="50" CornerRadius="25"
                            Shadow="{Shadow Brush=Black, Offset='0,4', Opacity=0.2}"/>
                </VerticalStackLayout>

                <BoxView HeightRequest="1" Color="#EEE" Margin="0,10"/>

                <Label Text="Meus VÃ­deos Publicados" FontSize="16" FontAttributes="Bold" TextColor="#333"/>

                <CollectionView ItemsSource="{Binding MyPublishedVideos}" HeightRequest="300">
                    <CollectionView.EmptyView>
                        <Label Text="Nenhum vÃ­deo publicado ainda." TextColor="#999" HorizontalOptions="Center" Margin="20"/>
                    </CollectionView.EmptyView>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border Stroke="#EEE" BackgroundColor="#F9F9F9" StrokeShape="RoundRectangle 10" Margin="0,0,0,10" Padding="10">
                                <Grid ColumnDefinitions="40, *, Auto">
                                    <Border BackgroundColor="#E1BEE7" HeightRequest="40" WidthRequest="40" StrokeShape="RoundRectangle 20" StrokeThickness="0">
                                        <Label Text="â–¶" HorizontalOptions="Center" VerticalOptions="Center" TextColor="#8E24AA"/>
                                    </Border>

                                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Margin="10,0">
                                        <Label Text="{Binding Description}" FontAttributes="Bold" TextColor="#333" LineBreakMode="TailTruncation"/>
                                        <Label Text="{Binding CreatedAt, StringFormat='{0:dd/MM/yyyy}'}" FontSize="12" TextColor="#666"/>
                                    </VerticalStackLayout>

                                    <ImageButton Grid.Column="2" 
                                                 Command="{Binding Source={RelativeSource AncestorType={x:Type vm:PartnerUploadViewModel}}, Path=DeleteVideoCommand}"
                                                 CommandParameter="{Binding .}"
                                                 Source="{FontImageSource Glyph='ðŸ—‘', Color='Red', Size=20}"
                                                 HeightRequest="40" WidthRequest="40" 
                                                 BackgroundColor="Transparent"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>

        <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" 
                           Color="#FF4081" VerticalOptions="Center" HorizontalOptions="Center" Grid.RowSpan="2"/>
    </Grid>
</ContentPage>
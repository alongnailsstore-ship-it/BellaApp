<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:BellaLink.App.ViewModels"
             x:Class="BellaLink.App.Views.RegisterPage"
             Title="Criar Conta"
             BackgroundColor="White"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto, *">

        <Grid Grid.Row="0" Padding="20,10" ColumnDefinitions="Auto, *">
            <ImageButton Grid.Column="0" 
                         Command="{Binding GoBackCommand}" 
                         HeightRequest="40" WidthRequest="40" 
                         HorizontalOptions="Start" 
                         VerticalOptions="Center"
                         BackgroundColor="Transparent">
                <ImageButton.Source>
                    <FontImageSource Glyph="â¬…" Color="#333" Size="30"/>
                </ImageButton.Source>
            </ImageButton>
        </Grid>

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="20" Padding="30, 0, 30, 40">

                <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                    <Border HeightRequest="100" WidthRequest="100" StrokeShape="RoundRectangle 50" BackgroundColor="#E0E0E0" StrokeThickness="0">
                        <Grid>
                            <Path Data="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"
                                  Fill="Gray" HorizontalOptions="Center" VerticalOptions="Center" Scale="3" TranslationY="5"/>
                        </Grid>
                    </Border>
                    <Label Text="Nova Conta" FontSize="24" FontAttributes="Bold" TextColor="#FF4081" HorizontalOptions="Center"/>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="15">
                    <Label Text="Dados Pessoais &amp; Contato" FontAttributes="Bold" TextColor="#333" />

                    <Border Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                        <Entry Placeholder="Nome Completo" 
                               Text="{Binding Name}" 
                               TextColor="#333" 
                               PlaceholderColor="#888"/>
                    </Border>

                    <Border Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                        <Entry Placeholder="CPF (000.000.000-00)" 
                               Text="{Binding Cpf}" 
                               Keyboard="Numeric"
                               TextColor="#333"
                               PlaceholderColor="#888"
                               MaxLength="14"
                               TextChanged="OnCpfChanged"/>
                    </Border>

                    <Border Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                        <Entry Placeholder="E-mail (Login)" 
                               Text="{Binding Email}" 
                               Keyboard="Email" 
                               TextColor="#333"
                               PlaceholderColor="#888"/>
                    </Border>

                    <Border Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                        <Entry Placeholder="WhatsApp (99) 99999-9999" 
                               Text="{Binding WhatsApp}" 
                               Keyboard="Numeric" 
                               TextColor="#333" 
                               PlaceholderColor="#888"
                               TextChanged="OnPhoneChanged" 
                               MaxLength="15" />
                    </Border>

                    <Grid ColumnDefinitions="*, *" ColumnSpacing="10">
                        <Border Grid.Column="0" Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                            <Entry Placeholder="Senha" 
                                   Text="{Binding Password}" 
                                   IsPassword="True" 
                                   TextColor="#333"
                                   PlaceholderColor="#888"/>
                        </Border>
                        <Border Grid.Column="1" Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                            <Entry Placeholder="Confirmar" 
                                   Text="{Binding ConfirmPassword}" 
                                   IsPassword="True" 
                                   TextColor="#333"
                                   PlaceholderColor="#888"/>
                        </Border>
                    </Grid>
                </VerticalStackLayout>

                <BoxView HeightRequest="1" Color="#EEE" Margin="0,10" />

                <VerticalStackLayout Spacing="15">
                    <Label Text="EndereÃ§o Principal" FontAttributes="Bold" TextColor="#333" />

                    <Border Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                        <Entry Placeholder="Nome do Local (Ex: Casa)" 
                               Text="{Binding AddressLabel}" 
                               TextColor="#333"
                               PlaceholderColor="#888"/>
                    </Border>

                    <Grid ColumnDefinitions="120, *" ColumnSpacing="10">
                        <Border Grid.Column="0" Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                            <Entry Placeholder="CEP" 
                                   Text="{Binding ZipCode}" 
                                   Keyboard="Numeric" 
                                   MaxLength="9" 
                                   TextColor="#333"
                                   PlaceholderColor="#888"/>
                        </Border>
                        <Border Grid.Column="1" Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                            <Entry Placeholder="Cidade" 
                                   Text="{Binding City}" 
                                   TextColor="#333"
                                   PlaceholderColor="#888"/>
                        </Border>
                    </Grid>

                    <Grid ColumnDefinitions="*, 80" ColumnSpacing="10">
                        <Border Grid.Column="0" Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                            <Entry Placeholder="Rua / Avenida" 
                                   Text="{Binding Street}" 
                                   TextColor="#333"
                                   PlaceholderColor="#888"/>
                        </Border>
                        <Border Grid.Column="1" Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                            <Entry Placeholder="NÂº" 
                                   Text="{Binding Number}" 
                                   Keyboard="Numeric" 
                                   TextColor="#333"
                                   PlaceholderColor="#888"/>
                        </Border>
                    </Grid>

                    <Grid ColumnDefinitions="*, 80" ColumnSpacing="10">
                        <Border Grid.Column="0" Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                            <Entry Placeholder="Bairro" 
                                   Text="{Binding Neighborhood}" 
                                   TextColor="#333"
                                   PlaceholderColor="#888"/>
                        </Border>
                        <Border Grid.Column="1" Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                            <Entry Placeholder="UF" 
                                   Text="{Binding State}" 
                                   TextColor="#333" 
                                   MaxLength="2" 
                                   PlaceholderColor="#888"/>
                        </Border>
                    </Grid>

                    <Button Text="+ Adicionar EndereÃ§o" Command="{Binding AddAddressCommand}" BackgroundColor="#EEE" TextColor="#333" HeightRequest="40" Margin="0,5" />

                    <CollectionView ItemsSource="{Binding AddedAddresses}" HeightRequest="100">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border StrokeThickness="0" BackgroundColor="#F9F9F9" Padding="10" Margin="0,5" StrokeShape="RoundRectangle 5">
                                    <Grid ColumnDefinitions="*, Auto">
                                        <VerticalStackLayout>
                                            <Label Text="{Binding Label}" FontAttributes="Bold" TextColor="#333" />
                                            <Label Text="{Binding Street}" FontSize="12" TextColor="#666" />
                                        </VerticalStackLayout>
                                        <Button Grid.Column="1" Text="ðŸ—‘ï¸" 
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:RegisterViewModel}}, Path=RemoveAddressCommand}" 
                                                CommandParameter="{Binding .}" 
                                                BackgroundColor="Transparent" TextColor="Red" Padding="0" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>

                <BoxView HeightRequest="1" Color="#EEE" Margin="0,10" />

                <VerticalStackLayout Spacing="10">
                    <Label Text="Selecione seu Perfil" FontAttributes="Bold" TextColor="#333" />

                    <HorizontalStackLayout Spacing="15">
                        <HorizontalStackLayout Spacing="5">
                            <CheckBox IsChecked="{Binding IsConsumer}" Color="#FF4081" />
                            <Label Text="Cliente" VerticalOptions="Center" TextColor="#555" />
                        </HorizontalStackLayout>

                        <HorizontalStackLayout Spacing="5">
                            <CheckBox IsChecked="{Binding IsPartner, Mode=TwoWay}" Color="#FF4081" />
                            <Label Text="Parceiro" VerticalOptions="Center" TextColor="#555" />
                        </HorizontalStackLayout>

                        <HorizontalStackLayout Spacing="5">
                            <CheckBox IsChecked="{Binding IsSupplier, Mode=TwoWay}" Color="#FF4081" />
                            <Label Text="Distribuidor" VerticalOptions="Center" TextColor="#555" />
                        </HorizontalStackLayout>
                    </HorizontalStackLayout>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="15">
                    <VerticalStackLayout.Triggers>
                        <DataTrigger TargetType="VerticalStackLayout" Binding="{Binding IsPartner}" Value="True">
                            <Setter Property="IsVisible" Value="True" />
                        </DataTrigger>
                        <DataTrigger TargetType="VerticalStackLayout" Binding="{Binding IsSupplier}" Value="True">
                            <Setter Property="IsVisible" Value="True" />
                        </DataTrigger>
                    </VerticalStackLayout.Triggers>

                    <VerticalStackLayout Spacing="15" IsVisible="{Binding IsPartner}">
                        <Label Text="Dados do NegÃ³cio" FontAttributes="Bold" TextColor="#333" />
                        <Border Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" BackgroundColor="White">
                            <Entry Placeholder="Nome da Loja" 
                                   Text="{Binding StoreName}" 
                                   TextColor="#333"
                                   PlaceholderColor="#888"/>
                        </Border>

                        <HorizontalStackLayout Spacing="5">
                            <Switch IsToggled="{Binding IsCorporate}" OnColor="#FF4081" />
                            <Label Text="Tenho CNPJ" VerticalOptions="Center" TextColor="#333" />
                        </HorizontalStackLayout>

                        <Border Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="15,0" HeightRequest="50" IsVisible="{Binding IsCorporate}" BackgroundColor="White">
                            <Entry Placeholder="CNPJ" 
                                   Text="{Binding Cnpj}" 
                                   Keyboard="Numeric" 
                                   TextColor="#333" 
                                   TextChanged="OnCnpjChanged" 
                                   MaxLength="18"
                                   PlaceholderColor="#888"/>
                        </Border>
                    </VerticalStackLayout>
                </VerticalStackLayout>

                <Button Text="FINALIZAR CADASTRO" Command="{Binding RegisterCommand}" BackgroundColor="#FF4081" TextColor="White" FontAttributes="Bold" CornerRadius="25" HeightRequest="55" Margin="0,20,0,0" />

                <Label Text="Voltar ao Login" TextColor="#999" HorizontalOptions="Center" TextDecorations="Underline">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding GoBackCommand}" />
                    </Label.GestureRecognizers>
                </Label>

                <ActivityIndicator IsRunning="{Binding IsLoading}" IsVisible="{Binding IsLoading}" Color="#FF4081" HorizontalOptions="Center" />

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>